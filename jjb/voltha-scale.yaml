---
# VOLTHA 2.x scale measurements

- project:
    name: voltha-scale

    project-name: '{name}'

    jobs:
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-8-16-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 16
          ponPorts: 8
          expectedOnus: 128
          BBSIMdelay: 200
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-8-16-1000ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 16
          ponPorts: 8
          expectedOnus: 128
          BBSIMdelay: 1000
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-8-32-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 32
          ponPorts: 8
          expectedOnus: 256
          BBSIMdelay: 200
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-8-32-1000ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 32
          ponPorts: 8
          expectedOnus: 256
          BBSIMdelay: 1000
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-10-20-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 20
          ponPorts: 10
          expectedOnus: 200
          BBSIMdelay: 200
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-10-20-1000ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 20
          ponPorts: 10
          expectedOnus: 200
          BBSIMdelay: 1000
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-4-32-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 32
          ponPorts: 4
          expectedOnus: 128
          BBSIMdelay: 200
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-4-32-1000ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 32
          ponPorts: 4
          expectedOnus: 128
          BBSIMdelay: 1000

      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-16-32-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 32
          ponPorts: 16
          expectedOnus: 512
          BBSIMdelay: 200
          # multi-adapter-tmp-changes
          volthaImg: "matteoscandolo/voltha-rw-core:partition"
          ofAgentImg: "voltha/voltha-ofagent-go:master"
          openoltAdapterImg: "matteoscandolo/voltha-openolt-adapter:partition"
          openonuAdapterImg: "matteoscandolo/voltha-openonu-adapter:partition"
          openonuAdapterChart: "/home/cord/voltha-helm-charts/voltha-adapter-openonu"
          extraHelmFlags: "--set use_ofagent_go=true -f /home/cord/partition-values.yaml"
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-16-64-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 64
          ponPorts: 16
          expectedOnus: 1024
          BBSIMdelay: 200
          # multi-adapter-tmp-changes
          volthaImg: "matteoscandolo/voltha-rw-core:partition"
          ofAgentImg: "voltha/voltha-ofagent-go:master"
          openoltAdapterImg: "matteoscandolo/voltha-openolt-adapter:partition"
          openonuAdapterImg: "matteoscandolo/voltha-openonu-adapter:partition"
          openonuAdapterChart: "/home/cord/voltha-helm-charts/voltha-adapter-openonu"
          extraHelmFlags: "--set use_ofagent_go=true -f /home/cord/partition-values.yaml"

      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-4-64-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 64
          ponPorts: 4
          expectedOnus: 256
          BBSIMdelay: 200
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-4-64-1000ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 64
          ponPorts: 4
          expectedOnus: 256
          BBSIMdelay: 1000
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-4-128-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 128
          ponPorts: 4
          expectedOnus: 512
          BBSIMdelay: 200
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-4-128-1000ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 128
          ponPorts: 4
          expectedOnus: 512
          BBSIMdelay: 1000
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-1-128-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 128
          ponPorts: 1
          expectedOnus: 128
          BBSIMdelay: 200
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-1-128-1000ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 128
          ponPorts: 1
          expectedOnus: 128
          BBSIMdelay: 1000
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-1-64-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 64
          ponPorts: 1
          expectedOnus: 64
          BBSIMdelay: 200
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-1-64-1000ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 64
          ponPorts: 1
          expectedOnus: 64
          BBSIMdelay: 1000
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-1-1-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 1
          ponPorts: 1
          expectedOnus: 1
          BBSIMdelay: 200
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-1-1-1000ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 1
          ponPorts: 1
          expectedOnus: 1
          BBSIMdelay: 1000
      - 'voltha-scale-measurements':
          name: 'voltha-scale-measurements-dev'
          build-node: 'voltha-scale'
          onuPerPon: 16
          ponPorts: 1
          expectedOnus: 16
          BBSIMdelay: 200

- job-template:
    id: 'voltha-scale-measurements-periodic'
    name: '{name}'
    pipeline-script: 'voltha-scale-measurements.groovy'

    description: |
      <!-- Managed by Jenkins Job Builder -->
      Created by {id} job-template from ci-management/jjb/voltha-scale.yaml  <br /><br />
      Using pipeline {pipeline-script} <br/><br/>
      Scale measurements for VOLTHA 2.x

    properties:
      - cord-infra-properties:
          build-days-to-keep: '{build-days-to-keep}'
          artifact-num-to-keep: '{artifact-num-to-keep}'

    wrappers:
      - lf-infra-wrappers:
          build-timeout: '{build-timeout}'
          jenkins-ssh-credential: '{jenkins-ssh-credential}'

    # default parameters
    bbsimImg: voltha/bbsim:master
    bbsimChart: onf/bbsim
    volthaImg: voltha/voltha-rw-core:master
    ofAgentImg: voltha/voltha-ofagent-go:master
    volthaChart: onf/voltha
    openoltAdapterImg:  voltha/voltha-openolt-adapter:master
    openoltAdapterChart: onf/voltha-adapter-openolt
    openonuAdapterImg: voltha/voltha-openonu-adapter:master
    openonuAdapterChart: onf/voltha-adapter-openonu
    onosImg: voltha/voltha-onos:master
    extraHelmFlags: ''

    parameters:
      - string:
          name: buildNode
          default: '{build-node}'
          description: 'Name of the Jenkins node to run the job on'

      - string:
          name: logLevel
          default: 'WARN'
          description: 'Log level for all the components'

      - string:
          name: onuPerPon
          default: '{onuPerPon}'
          description: 'Number of ONUs to provision'

      - string:
          name: ponPorts
          default: '{ponPorts}'
          description: 'Number of PONs to provision'

      - string:
          name: expectedOnus
          default: '{expectedOnus}'
          description: 'Expected number of activated ONUs'

      - string:
          name: pollInterval
          default: 5
          description: 'Sleep time between ONU activation checks'

      - bool:
          name: withOnosApps
          default: false
          description: 'Option to deactivate certain ONOS apps'

      - bool:
          name: withMibTemplate
          default: true
          description: 'Option to trigger MIB template command'

      - bool:
          name: setLinkDiscovery
          default: false
          description: 'Option to toggle Link Discovery'

      - string:
          name: BBSIMdelay
          default: '{BBSIMdelay}'
          description: 'BBSIM Delay, milliseconds'

      - string:
          name: flowStatInterval
          default: 600
          description: 'Flow Stats Collection Interval, milliseconds'

      - string:
          name: portsStatInterval
          default: 600
          description: 'Ports Stats Collection Interval, milliseconds'

      - bool:
          name: bbsimAuth
          default: true
          description: 'Option to toggle BBSIM EAPOL true/false'

      - bool:
          name: bbsimDhcp
          default: true
          description: 'Option to toggle BBSIM DHCP true/false'

      - string:
          name: bbsimImg
          default: '{bbsimImg}'
          description: 'Custom image selection for BBSIM (repo:tag)'

      - string:
          name: bbsimChart
          default: '{bbsimChart}'
          description: 'BBSim chart name (or location on file system)'

      - string:
          name: volthaImg
          default: '{volthaImg}'
          description: 'Custom image selection for VOLTHA (repo:tag)'

      - string:
          name: ofAgentImg
          default: '{ofAgentImg}'
          description: 'Custom image selection for OfAgent (repo:tag), only supports the go version'

      - string:
          name: volthaChart
          default: '{volthaChart}'
          description: 'VOLTHA chart name (or location on file system)'

      - string:
          name: openoltAdapterImg
          default: '{openoltAdapterImg}'
          description: 'Custom image selection for Openolt Adapter (repo:tag)'

      - string:
          name: openoltAdapterChart
          default: '{openoltAdapterChart}'
          description: 'OpenOLT chart name (or location on file system)'

      - string:
          name: openonuAdapterImg
          default: '{openonuAdapterImg}'
          description: 'Custom image selection for Openonu Adapter (repo:tag)'

      - string:
          name: openonuAdapterChart
          default: '{openonuAdapterChart}'
          description: 'OpenONU chart name (or location on file system)'

      - string:
          name: onosImg
          default: '{onosImg}'
          description: 'Custom image selection for Openonu Adapter (repo:tag)'

      - string:
          name: extraHelmFlags
          default: '{extraHelmFlags}'
          description: 'Any extra helm parameters you want (passed to every helm install command)'

    # kafka configOverride
    configurationOverrides:
        "offsets.topic.replication.factor": 1
        "log.retention.hours": 4
        "log.message.timestamp.type": "LogAppendTime"

    project-type: pipeline
    concurrent: false

    dsl: !include-raw-escape: pipeline/{pipeline-script}

    triggers:
      - timed: |
                 TZ=America/Los_Angeles
                 {time-trigger}

- job-template:
    id: 'voltha-scale-measurements'
    name: '{name}'
    pipeline-script: 'voltha-scale-measurements.groovy'

    description: |
      <!-- Managed by Jenkins Job Builder -->
      Created by {id} job-template from ci-management/jjb/voltha-scale.yaml  <br /><br />
      Using pipeline {pipeline-script} <br/><br/>
      Scale measurements for VOLTHA 2.x

    properties:
      - cord-infra-properties:
          build-days-to-keep: '{build-days-to-keep}'
          artifact-num-to-keep: '{artifact-num-to-keep}'

    wrappers:
      - lf-infra-wrappers:
          build-timeout: '{build-timeout}'
          jenkins-ssh-credential: '{jenkins-ssh-credential}'

    # default parameters
    bbsimImg: "voltha/bbsim:master"
    bbsimChart: "onf/bbsim"
    volthaImg: "voltha/voltha-rw-core:master"
    ofAgentImg: "voltha/voltha-ofagent-go:master"
    volthaChart: "onf/voltha"
    openoltAdapterImg: "voltha/voltha-openolt-adapter:master"
    openoltAdapterChart: "onf/voltha-adapter-openolt"
    openonuAdapterImg: "voltha/voltha-openonu-adapter:master"
    openonuAdapterChart: "onf/voltha-adapter-openonu"
    onosImg: "voltha/voltha-onos:4.0.1"
    extraHelmFlags: ''

    parameters:
      - string:
          name: buildNode
          default: '{build-node}'
          description: 'Name of the Jenkins node to run the job on'

      - string:
          name: logLevel
          default: 'WARN'
          description: 'Log level for all the components'

      - string:
          name: onuPerPon
          default: 1
          description: 'Number of ONUs to provision'

      - string:
          name: ponPorts
          default: 1
          description: 'Number of PONs to provision'

      - string:
          name: expectedOnus
          default: 1
          description: 'Expected number of activated ONUs'

      - string:
          name: pollInterval
          default: 5
          description: 'Sleep time between ONU activation checks'

      - bool:
          name: withOnosApps
          default: false
          description: 'Option to deactivate certain ONOS apps'

      - bool:
          name: withMibTemplate
          default: true
          description: 'Option to trigger MIB template command'

      - bool:
          name: setLinkDiscovery
          default: false
          description: 'Option to toggle Link Discovery'

      - string:
          name: BBSIMdelay
          default: 200
          description: 'BBSIM Delay, milliseconds'

      - string:
          name: flowStatInterval
          default: 600
          description: 'Flow Stats Collection Interval, milliseconds'

      - string:
          name: portsStatInterval
          default: 600
          description: 'Ports Stats Collection Interval, milliseconds'

      - bool:
          name: bbsimAuth
          default: true
          description: 'Option to toggle BBSIM EAPOL true/false'

      - bool:
          name: bbsimDhcp
          default: true
          description: 'Option to toggle BBSIM DHCP true/false'

      - string:
          name: bbsimImg
          default: '{bbsimImg}'
          description: 'Custom image selection for BBSIM (repo:tag)'

      - string:
          name: bbsimChart
          default: '{bbsimChart}'
          description: 'BBSim chart name (or location on file system)'

      - string:
          name: volthaImg
          default: '{volthaImg}'
          description: 'Custom image selection for VOLTHA (repo:tag)'

      - string:
          name: ofAgentImg
          default: '{ofAgentImg}'
          description: 'Custom image selection for OfAgent (repo:tag), only supports the go version'

      - string:
          name: volthaChart
          default: '{volthaChart}'
          description: 'VOLTHA chart name (or location on file system)'

      - string:
          name: openoltAdapterImg
          default: '{openoltAdapterImg}'
          description: 'Custom image selection for Openolt Adapter (repo:tag)'

      - string:
          name: openoltAdapterChart
          default: '{openoltAdapterChart}'
          description: 'OpenOLT chart name (or location on file system)'

      - string:
          name: openonuAdapterImg
          default: '{openonuAdapterImg}'
          description: 'Custom image selection for Openonu Adapter (repo:tag)'

      - string:
          name: openonuAdapterChart
          default: '{openonuAdapterChart}'
          description: 'OpenONU chart name (or location on file system)'

      - string:
          name: onosImg
          default: '{onosImg}'
          description: 'Custom image selection for Openonu Adapter (repo:tag)'

      - string:
          name: extraHelmFlags
          default: '{extraHelmFlags}'
          description: 'Any extra helm parameters you want (passed to every helm install command)'

    # kafka configOverride
    configurationOverrides:
        "offsets.topic.replication.factor": 1
        "log.retention.hours": 4
        "log.message.timestamp.type": "LogAppendTime"

    project-type: pipeline
    concurrent: false

    dsl: !include-raw-escape: pipeline/{pipeline-script}
