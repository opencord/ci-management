---
# VOLTHA 2.x scale measurements

- project:
    name: voltha-scale

    project-name: '{name}'

    jobs:
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-8-16-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 16
          ponPorts: 8
          expectedOnus: 128
          BBSIMdelay: 200
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-8-32-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 32
          ponPorts: 8
          expectedOnus: 256
          BBSIMdelay: 200
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-10-20-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 20
          ponPorts: 10
          expectedOnus: 200
          BBSIMdelay: 200
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-4-32-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 32
          ponPorts: 4
          expectedOnus: 128
          BBSIMdelay: 200
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-16-32-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 32
          ponPorts: 16
          expectedOnus: 512
          BBSIMdelay: 200
          # multi-adapter
          extraHelmFlags: "--set replicas.adapter_open_onu=8"
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-16-64-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 64
          ponPorts: 16
          expectedOnus: 1024
          BBSIMdelay: 200
          # multi-adapter
          extraHelmFlags: "--set replicas.adapter_open_onu=8"
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-4-64-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 64
          ponPorts: 4
          expectedOnus: 256
          BBSIMdelay: 200
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-1-128-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 128
          ponPorts: 1
          expectedOnus: 128
          BBSIMdelay: 200
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-1-64-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 64
          ponPorts: 1
          expectedOnus: 64
          BBSIMdelay: 200
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-1-1-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 1
          ponPorts: 1
          expectedOnus: 1
          BBSIMdelay: 200
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-2-OLTs-10-10-200ms'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 10
          ponPorts: 10
          numOfBbsim: 2
          expectedOnus: 200
          BBSIMdelay: 200
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-10-20-200ms-with-flows'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 20
          ponPorts: 10
          expectedOnus: 200
          BBSIMdelay: 200
          withOnosApps: true
          flowStatInterval: 5
          portsStatInterval: 5
          expectedFlows: 201
          bbsimAuth: false
          bbsimDhcp: false
      - 'voltha-scale-measurements-periodic':
          name: 'voltha-scale-measurements-periodic-10-20-200ms-complete'
          build-node: 'onf-pod1-head-node'
          time-trigger: "H H/4 * * *"
          onuPerPon: 16
          ponPorts: 4
          expectedOnus: 64
          BBSIMdelay: 200
          withOnosApps: true
          flowStatInterval: 5
          portsStatInterval: 5
          expectedFlows: 65
      - 'voltha-scale-measurements':
          name: 'voltha-scale-measurements-dev'
          build-node: 'voltha-scale'
          onuPerPon: 16
          ponPorts: 1
          expectedOnus: 16
          BBSIMdelay: 200

- job-template:
    id: 'voltha-scale-measurements-periodic'
    name: '{name}'
    pipeline-script: 'voltha-scale-measurements.groovy'

    description: |
      <!-- Managed by Jenkins Job Builder -->
      Created by {id} job-template from ci-management/jjb/voltha-scale.yaml  <br /><br />
      Using pipeline {pipeline-script} <br/><br/>
      Scale measurements for VOLTHA 2.x

    properties:
      - cord-infra-properties:
          build-days-to-keep: '{build-days-to-keep}'
          artifact-num-to-keep: '{artifact-num-to-keep}'

    wrappers:
      - lf-infra-wrappers:
          build-timeout: '{build-timeout}'
          jenkins-ssh-credential: '{jenkins-ssh-credential}'

    # default parameters
    bbsimImg: voltha/bbsim:master
    bbsimChart: onf/bbsim
    volthaImg: voltha/voltha-rw-core:master
    ofAgentImg: voltha/voltha-ofagent-go:master
    volthaChart: onf/voltha
    openoltAdapterImg:  voltha/voltha-openolt-adapter:master
    openoltAdapterChart: onf/voltha-adapter-openolt
    openonuAdapterImg: voltha/voltha-openonu-adapter:master
    openonuAdapterChart: onf/voltha-adapter-openonu
    onosImg: voltha/voltha-onos:master
    extraHelmFlags: ''
    withMibTemplate: true
    numOfBbsim: 1
    numOfKafka: 3
    withOnosApps: false
    setLinkDiscovery: false
    flowStatInterval: 600
    portsStatInterval: 600
    expectedFlows: 0 # by defualt ONOS apps are deactivated
    bbsimAuth: true
    bbsimDhcp: true

    parameters:
      - string:
          name: buildNode
          default: '{build-node}'
          description: 'Name of the Jenkins node to run the job on'

      - string:
          name: logLevel
          default: 'WARN'
          description: 'Log level for all the components'

      - string:
          name: onuPerPon
          default: '{onuPerPon}'
          description: 'Number of ONUs to provision'

      - string:
          name: ponPorts
          default: '{ponPorts}'
          description: 'Number of PONs to provision'

      - string:
          name: expectedOnus
          default: '{expectedOnus}'
          description: 'Expected number of activated ONUs'

      - string:
          name: expectedFlows
          default: '{expectedFlows}'
          description: 'Expected number of flows in ONOS'

      - string:
          name: pollInterval
          default: 5
          description: 'Sleep time between ONU activation checks'

      - bool:
          name: withOnosApps
          default: '{withOnosApps}'
          description: 'Option to deactivate certain ONOS apps'

      - bool:
          name: withMibTemplate
          default: '{withMibTemplate}'
          description: 'Option to trigger MIB template command'

      - bool:
          name: setLinkDiscovery
          default: '{setLinkDiscovery}'
          description: 'Option to toggle Link Discovery'

      - string:
          name: BBSIMdelay
          default: '{BBSIMdelay}'
          description: 'BBSIM Delay, milliseconds'

      - string:
          name: flowStatInterval
          default: '{flowStatInterval}'
          description: 'Flow Stats Collection Interval, milliseconds'

      - string:
          name: portsStatInterval
          default: {portsStatInterval}
          description: 'Ports Stats Collection Interval, milliseconds'

      - bool:
          name: bbsimAuth
          default: '{bbsimAuth}'
          description: 'Option to toggle BBSIM EAPOL true/false'

      - bool:
          name: bbsimDhcp
          default: '{bbsimDhcp}'
          description: 'Option to toggle BBSIM DHCP true/false'

      - string:
          name: bbsimImg
          default: '{bbsimImg}'
          description: 'Custom image selection for BBSIM (repo:tag)'

      - string:
          name: bbsimChart
          default: '{bbsimChart}'
          description: 'BBSim chart name (or location on file system)'

      - string:
          name: volthaImg
          default: '{volthaImg}'
          description: 'Custom image selection for VOLTHA (repo:tag)'

      - string:
          name: ofAgentImg
          default: '{ofAgentImg}'
          description: 'Custom image selection for OfAgent (repo:tag), only supports the go version'

      - string:
          name: volthaChart
          default: '{volthaChart}'
          description: 'VOLTHA chart name (or location on file system)'

      - string:
          name: openoltAdapterImg
          default: '{openoltAdapterImg}'
          description: 'Custom image selection for Openolt Adapter (repo:tag)'

      - string:
          name: openoltAdapterChart
          default: '{openoltAdapterChart}'
          description: 'OpenOLT chart name (or location on file system)'

      - string:
          name: openonuAdapterImg
          default: '{openonuAdapterImg}'
          description: 'Custom image selection for Openonu Adapter (repo:tag)'

      - string:
          name: openonuAdapterChart
          default: '{openonuAdapterChart}'
          description: 'OpenONU chart name (or location on file system)'

      - string:
          name: onosImg
          default: '{onosImg}'
          description: 'Custom image selection for Openonu Adapter (repo:tag)'

      - string:
          name: extraHelmFlags
          default: '{extraHelmFlags}'
          description: 'Any extra helm parameters you want (passed to every helm install command)'

      - string:
          name: numOfBbsim
          default: '{numOfBbsim}'
          description: 'How many BBSim instances to run'

      - string:
          name: numOfKafka
          default: '{numOfKafka}'
          description: 'How many Kafka instances to run'

    project-type: pipeline
    concurrent: false

    dsl: !include-raw-escape: pipeline/{pipeline-script}

    triggers:
      - timed: |
                 TZ=America/Los_Angeles
                 {time-trigger}

- job-template:
    id: 'voltha-scale-measurements'
    name: '{name}'
    pipeline-script: 'voltha-scale-measurements.groovy'

    description: |
      <!-- Managed by Jenkins Job Builder -->
      Created by {id} job-template from ci-management/jjb/voltha-scale.yaml  <br /><br />
      Using pipeline {pipeline-script} <br/><br/>
      Scale measurements for VOLTHA 2.x

    properties:
      - cord-infra-properties:
          build-days-to-keep: '{build-days-to-keep}'
          artifact-num-to-keep: '{artifact-num-to-keep}'

    wrappers:
      - lf-infra-wrappers:
          build-timeout: '{build-timeout}'
          jenkins-ssh-credential: '{jenkins-ssh-credential}'

    # default parameters
    bbsimImg: "voltha/bbsim:master"
    bbsimChart: "onf/bbsim"
    volthaImg: "voltha/voltha-rw-core:master"
    ofAgentImg: "voltha/voltha-ofagent-go:master"
    volthaChart: "onf/voltha"
    openoltAdapterImg: "voltha/voltha-openolt-adapter:master"
    openoltAdapterChart: "onf/voltha-adapter-openolt"
    openonuAdapterImg: "voltha/voltha-openonu-adapter:master"
    openonuAdapterChart: "onf/voltha-adapter-openonu"
    onosImg: "voltha/voltha-onos:master"
    extraHelmFlags: ''
    withMibTemplate: true
    numOfBbsim: 1
    numOfKafka: 3
    withOnosApps: true
    setLinkDiscovery: false
    flowStatInterval: 600
    portsStatInterval: 600
    expectedFlows: 17 # one EAPOL per ONU + 1 LLDP on the NNI
    bbsimAuth: true
    bbsimDhcp: true

    parameters:
      - string:
          name: buildNode
          default: '{build-node}'
          description: 'Name of the Jenkins node to run the job on'

      - string:
          name: logLevel
          default: 'WARN'
          description: 'Log level for all the components'

      - string:
          name: onuPerPon
          default: 1
          description: 'Number of ONUs to provision'

      - string:
          name: ponPorts
          default: 1
          description: 'Number of PONs to provision'

      - string:
          name: expectedOnus
          default: 1
          description: 'Expected number of activated ONUs'

      - string:
          name: expectedFlows
          default: '{expectedFlows}'
          description: 'Expected number of flows in ONOS'

      - string:
          name: pollInterval
          default: 5
          description: 'Sleep time between ONU activation checks'

      - bool:
          name: withOnosApps
          default: '{withOnosApps}'
          description: 'Option to deactivate certain ONOS apps'

      - bool:
          name: withMibTemplate
          default: '{withMibTemplate}'
          description: 'Option to trigger MIB template command'

      - bool:
          name: setLinkDiscovery
          default: '{setLinkDiscovery}'
          description: 'Option to toggle Link Discovery'

      - string:
          name: BBSIMdelay
          default: 200
          description: 'BBSIM Delay, milliseconds'

      - string:
          name: flowStatInterval
          default: '{flowStatInterval}'
          description: 'Flow Stats Collection Interval, milliseconds'

      - string:
          name: portsStatInterval
          default: {portsStatInterval}
          description: 'Ports Stats Collection Interval, milliseconds'

      - bool:
          name: bbsimAuth
          default: '{bbsimAuth}'
          description: 'Option to toggle BBSIM EAPOL true/false'

      - bool:
          name: bbsimDhcp
          default: '{bbsimDhcp}'
          description: 'Option to toggle BBSIM DHCP true/false'

      - string:
          name: bbsimImg
          default: '{bbsimImg}'
          description: 'Custom image selection for BBSIM (repo:tag)'

      - string:
          name: bbsimChart
          default: '{bbsimChart}'
          description: 'BBSim chart name (or location on file system)'

      - string:
          name: volthaImg
          default: '{volthaImg}'
          description: 'Custom image selection for VOLTHA (repo:tag)'

      - string:
          name: ofAgentImg
          default: '{ofAgentImg}'
          description: 'Custom image selection for OfAgent (repo:tag), only supports the go version'

      - string:
          name: volthaChart
          default: '{volthaChart}'
          description: 'VOLTHA chart name (or location on file system)'

      - string:
          name: openoltAdapterImg
          default: '{openoltAdapterImg}'
          description: 'Custom image selection for Openolt Adapter (repo:tag)'

      - string:
          name: openoltAdapterChart
          default: '{openoltAdapterChart}'
          description: 'OpenOLT chart name (or location on file system)'

      - string:
          name: openonuAdapterImg
          default: '{openonuAdapterImg}'
          description: 'Custom image selection for Openonu Adapter (repo:tag)'

      - string:
          name: openonuAdapterChart
          default: '{openonuAdapterChart}'
          description: 'OpenONU chart name (or location on file system)'

      - string:
          name: onosImg
          default: '{onosImg}'
          description: 'Custom image selection for Openonu Adapter (repo:tag)'

      - string:
          name: extraHelmFlags
          default: '{extraHelmFlags}'
          description: 'Any extra helm parameters you want (passed to every helm install command)'

      - string:
          name: numOfBbsim
          default: '{numOfBbsim}'
          description: 'How many BBSim instances to run'

      - string:
          name: numOfKafka
          default: '{numOfKafka}'
          description: 'How many Kafka instances to run'

    project-type: pipeline
    concurrent: false

    dsl: !include-raw-escape: pipeline/{pipeline-script}
